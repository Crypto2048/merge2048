<!DOCTYPE HTML>
<html>
	<head>
		<title>Merge 2048</title>
		<meta charset="utf-8" />
		<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">  
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<script>
		const mint = async function() {
			if (typeof window.ethereum === 'undefined') {
				return;
			} else {
				console.log(window.ethereum);
			}

			if (window.ethereum.chainId != "0x89") {
                try {
                    await ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: '0x89' }],
                    });
                } catch (switchError) {
                    console.log("switchError: ", switchError)
                    // This error code indicates that the chain has not been added to MetaMask.
                    if (switchError.code === 4902) {
                        console.log("4902");
                        try {
                        await ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: '0x89', 
                                rpcUrls: ['https://polygon-rpc.com/'],
                                chainName: 'Polygon Mainnet',
                                blockExplorerUrls: ['https://polygonscan.com/']}],
                        });
                        } catch (addError) {
                            // handle "add" error
                            return;
                        }
                    }
                    // handle other "switch" errors
                    return;
                }
            }


		// Will Start the metamask extension
		await ethereum.request({ method: 'eth_requestAccounts' });

		 const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
		 console.log(accounts);

		 console.log("chainId: ", window.ethereum.chainId);
		 console.log("isMetaMask: ", window.ethereum.isMetaMask);

			var params = [
			  {
			    from: accounts[0],
			    to: '0x2048c74851f2ed5c45dB70CCb7898A73CFEDE11e',
			    data: "0x1249c58b",	// mint()
			  },
			];

			await ethereum
			  .request({
			    method: 'eth_sendTransaction',
			    params,
			  })
			  .then((result) => {
			    // The result varies by RPC method.
			    // For example, this method will return a transaction hash hexadecimal string on success.
				 console.log(result);
			  })
			  .catch((error) => {
			    // If the request fails, the Promise will reject with an error.
			  });
		}

		</script>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<div class="logo">
							<span>2048</span>
						</div>
						<div class="content">
							<div class="inner">
								<h1>Merge 2048</h1>
								<p>Merge2048 is an ERC-1155, but anyone cannot have two with the same token id at the same time.</p>
							</div>
						</div>
						<nav>
							<ul>
								<li><a href="https://crypto2048.org/">Home</a></li>
								<li><a href="javascript:mint();">Mint</a></li>
								<li><a href="https://opensea.io/collection/merge2048"  target="_blank">OpenSea</a></li>
							</ul>
						</nav>
					</header>

				<!-- Main -->
					<div id="main">

					</div>

				<!-- Footer -->
					<footer id="footer">
						<p class="copyright">Crypto2048 is the on-chain version of 2048.</p>
					</footer>

			</div>

		<!-- BG -->
			<div id="bg"></div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>
